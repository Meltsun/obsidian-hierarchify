# Hierarchify
一个obsidian笔记重构插件。提供了一些有用的功能，让我们更方便的管理知识的层级关系。

## why
试想一下，当我们要保存一些具有层级关系的知识，例如苹果香蕉西瓜三种水果。我们需要决定：
方案一：它们是一个文件夹下的三个笔记。
├─ 水果
│  ├─ 苹果.md
│  ├─ 香蕉.md
│  └─ 西瓜.md
方案二：它们是一个笔记中的三个二级标题。
```markdown
# 水果
## 苹果
## 香蕉
## 西瓜
```
方案三：它们是一个标题下的若干列表。
```markdown
## 水果
1. 苹果
2. 香蕉
3. 西瓜
```

例如，考虑到目前想记录的内容不多，所以我选择了最后一种方案，把它们放到一个列表中。这个选择是合理的。但之后，如果我想在其中增加若干内容，我要么忍受多级嵌套列表并避免添加无法容纳在列表中的内容，要么手动把它重构为方案二。如果内容继续增多，可能需要重构为方案一。在之后如果我想使用Zettelkasten，用链接管理笔记，我还需要手动为每个笔记添加链接。重构浪费了我们的时间。

一个好的方案是一开始就使用Zettelkasten并记原子化的笔记。但是文件树有它的好处，它更直观，更有利于记长笔记。

因此，此插件提供了下面的功能，为你省下做选择和重构笔记的时间，并允许你将zk和文件树混合使用。

## 功能
1. 标题列表互转
    - 标题转列表
    - 标题转其他等级的标题
    - 列表转标题
    - 在转换时会对所选择的标题下（或列表中）的内容做递归的处理，从而保留其结构
    - 选择标题时，可以选择重构此标题，或者所有平行标题
1. 内容整体提取
    - 对一个标题和其中内容，或者一个列表，进行整体剪切，便于后续复制到需要的位置。
1. 标题和文件互转
    - 把一个标题和其中内容提取为一个文件，使用标题作为文件名
    - 根据标题把笔记拆分为若干笔记，使用原笔记名作为文件夹名
    - TODO:把一个文件夹下的所有笔记合并到一个笔记
    - 合并和拆分笔记时会使用适当的调节标题的等级
1. 文件树链接
    - 在一个文件夹中创建一个同名笔记，并为文件夹中其他笔记添加到此笔记的链接。
    - 递归地处理文件夹中的所有子文件夹
    - 这允许你把笔记分散到不同文件夹而保留层级关系，换言之，将ZK和文件树混合使用。
    - 推荐和文件夹笔记插件配合使用
1. 为标题添加序号
    - 这让有序列表和标题之间的转化更直观
1. TODO:把所有链接到此笔记的笔记合并到此笔记（或此文件夹）（似乎不可行）
1. 以上功能基于mdast实现。即，把markdown转化为ast，进行某些修改，然后转回来。这相当于进行了格式化。

# 问题
## mdast的obsidian对markdown的处理不同
mdast的某些行为与obsidian编辑器的默认行为以及我的习惯不同，导致了一些一致性问题。
1. 会在有序列表项的序号和文字之间添加两个空格
1. 会为所有中括号添加转义字符等（这会导致wiki链接失效）。
1. 嵌套列表如果不以1开始不会被识别为列表
1. 代码块如果不标明语言则不会被识别为代码块

受限于我的能力和精力，我将信将疑的修改了部分代码并调整了部分obsidian设置解决了前两个问题，对笔记进行预处理解决了后面两个。
需要调整的obsidian设置如下：
1. 使用空格缩进
1. 制表符宽度设置为4

目前的测试远远不够，可能还有其他问题。所以目前所有重构功能都不会删除任何笔记内容。
## 缺少设置项
计划添加更多设置项来定义插件的行为。
1. 生成列表时
    1. 总是新建列表
    1. 优先合并已存在的列表。
2. 新建文件的位置
    1. 和选择的笔记位于同一文件夹中
    1. 固定位置
        1. 目录
4. 插入链接的模板